CREATE PROCEDURE ProcWithUnUsedCtes
AS 
BEGIN
; with cte1 as (
select * from [dbo].[Table1])
select *
from cte1;


; with cte1 as (
select * from [dbo].[Table1])
, cte2 as ( select * from cte1)
select *
from cte1;

; with cte1 as (
select * from [dbo].[Table1])
, cte2 as ( select * from cte1)
insert into Table1
select *
from cte1;

; with cte1 as (                            -- needs to have circular references fixed.
select * from [dbo].[Table1])
, cte2 as ( select * from cte1)
insert into Table1
select *
from Table1;


; with cte1 as (
select * from [dbo].[Table1])
, cte2 as ( select * from cte1)
update t1
set C1 = cte1.C1
from Table1 t1
cross join cte1;

; with cte1 as (
select * from [dbo].[Table1])
, cte2 as ( select * from cte1)
delete t1
from cte1 t1;

; with cte1 as (
select * from [dbo].[Table1])
, cte2 as ( select * from cte1)
merge into Table1 t1
using cte1 c1
on c1.C1= t1.c1
when not matched by target
then insert values (c1.C1,c1.c2)
;

; with cte1 as (
select * from [dbo].[Table1])
, cte2 as ( select * from cte1)
insert into Table1 
select C1,C2 from
(
merge into Table1 t1
using cte1 c1
on c1.C1= t1.c1
when not matched by target
then insert values (c1.C1,c1.c2)
output inserted.c1,inserted.c2
) src ;


END;